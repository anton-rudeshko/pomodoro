!function(a,b){function c(a){this.name=a||"",this.periods=[]}function d(a){this.type=a,this.time=(new Date).getTime()}function e(){return k.fromJson(l.tasks||"[]")}function f(a){l.tasks=k.toJson(a)}function g(){var a=b.createElement("audio");a.src="assets/alert.mp3",a.load(),a.play()}function h(a){b.title="Time is up!"+(a?" - "+a:"")+" - Pomodoro tracker",new Notification("Pomodoro tracker",{tag:"pomodoro-tracker",body:(a?a+" - ":"")+"Time is up!"}),g()}function i(a){return a=new Date(a),new Date(a.getFullYear(),a.getMonth(),a.getDate()).getTime()}function j(){return i(new Date)}var k=a.angular,l=a.localStorage||{},m=k.module("pomodoro",[]),n=l.isDev,o=1e3,p=60*o,q=n?o:p,r={pomodoro:25*q,shortBreak:5*q,longBreak:15*q},s="mm:ss",t="Some task",u=a.webkitNotifications;m.filter("todayPeriods",function(){return function(a){var b=j();return a.reduce(function(a,b){return a.concat(b.periods||[])},[]).filter(function(a){return b===i(a.time)})}}),m.controller("MainCtrl",["$scope","$interval","dateFilter",function(a,g,i){var j=this,k=a.tasks=e();a.timerType="pomodoro",a.formattedTime=i(r.pomodoro,s),a.currentTask=new c,a.removeTask=function(a){k.splice(k.indexOf(a),1),f(k)},j.updateTimeDisplay=function(c,d){a.formattedTime=i(c,s),b.title=a.formattedTime+(d?" - "+d:"")+" - Pomodoro tracker"},j.isTicking=function(){return!!j.countdownInterval},j.startCountdown=function(b,e){if(b&&e&&!j.isTicking()){var i=b,l=a.currentTask;k.some(function(b){return l.name.match(new RegExp(b.name.trim(),"gi"))?(a.currentTask=l=b,!0):!1}),a.timerType=e,j.updateTimeDisplay(i,l.name),j.countdownInterval=g(function(){i-=o,j.updateTimeDisplay(i,l.name)},o,i/o),j.countdownInterval.then(function(){j.countdownInterval=null,l.name||(l.name=t),~k.indexOf(l)||k.unshift(l),l.periods.push(new d(e)),a.currentTask=new c(l.name),h(l.name),f(k)})}},j.cancelCountdown=function(){g.cancel(j.countdownInterval),j.countdownInterval=null},j.restartCountdown=function(a,b){j.cancelCountdown(),j.startCountdown(a,b)},a.select=function(b){a.currentTask=b},a.start=function(a){b.activeElement.blur();var c=r[a];c&&j.restartCountdown(c,a)},a.submit=function(){b.activeElement.blur(),j.isTicking()||j.restartCountdown(r.pomodoro,"pomodoro")},a.showNotifyButton=u&&1===u.checkPermission(),a.turnNotifications=function(){u.requestPermission(),a.showNotifyButton=!1}}])}(window,document);