!function(a,b){function c(a){this.name=a||"",this.periods=[]}function d(){return JSON.parse(i.tasks||"[]")}function e(a){i.tasks=h.toJson(a)}function f(){var a=b.createElement("audio");a.src="assets/alert.mp3",a.load(),a.play()}function g(a){b.title="Time is up!"+(a?" - "+a:"")+" - Pomodoro tracker",new Notification("Pomodoro tracker",{tag:"pomodoro-tracker",body:(a?a+" - ":"")+"Time is up!"}),f()}var h=a.angular,i=a.localStorage||{},j=h.module("pomodoro",[]),k=i.isDev,l=1e3,m=60*l,n=k?l:m,o={pomodoro:25*n,shortBreak:5*n,longBreak:15*n},p="mm:ss",q="Some task",r=a.webkitNotifications;j.controller("MainCtrl",["$scope","$interval","dateFilter",function(a,f,h){var i=this,j=a.tasks=d();a.timerType="pomodoro",a.formattedTime=h(o.pomodoro,p),a.currentTask=new c,a.removeTask=function(a){j.splice(j.indexOf(a),1),e(j)},i.updateTimeDisplay=function(c,d){a.formattedTime=h(c,p),b.title=a.formattedTime+(d?" - "+d:"")+" - Pomodoro tracker"},i.isTicking=function(){return!!i.countdownInterval},i.startCountdown=function(b,d){if(b&&d&&!i.isTicking()){var h=b,k=a.currentTask;j.some(function(b){return k.name.match(new RegExp(b.name.trim(),"gi"))?(a.currentTask=k=b,!0):!1}),a.timerType=d,i.updateTimeDisplay(h,k.name),i.countdownInterval=f(function(){h-=l,i.updateTimeDisplay(h,k.name)},l,h/l),i.countdownInterval.then(function(){i.countdownInterval=null,k.name||(k.name=q),~j.indexOf(k)||j.unshift(k),k.periods.push({type:d}),a.currentTask=new c(k.name),g(k.name),e(j)})}},i.cancelCountdown=function(){f.cancel(i.countdownInterval),i.countdownInterval=null},i.restartCountdown=function(a,b){i.cancelCountdown(),i.startCountdown(a,b)},a.select=function(b){a.currentTask=b},a.start=function(a){b.activeElement.blur();var c=o[a];c&&i.restartCountdown(c,a)},a.submit=function(){b.activeElement.blur(),i.isTicking()||i.restartCountdown(o.pomodoro,"pomodoro")},a.showNotifyButton=r&&1===r.checkPermission(),a.turnNotifications=function(){r.requestPermission(),a.showNotifyButton=!1}}])}(window,document);